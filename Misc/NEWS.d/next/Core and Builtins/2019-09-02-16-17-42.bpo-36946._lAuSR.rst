Fix possible signed integer overflow when handling slices. Patch by hongweipeng.
